### Introduction

In this tutorial, we'll look at the Laravel sanctum package, discuss how we can use it to authenticate Single Page Applications (SPA), or even token-based APIs. We'll create a simple Laravel project, issue users with API tokens, and authenticate SPA using the Laravel inbuilt session.

We'll also have a look at its advantages over Laravel passport, discuss the reasons why you would choose it (sanctum) over Passport.

### Table of contents

- [Prerequisites](#prerequisites)
- [Objectives](#objectives)

### Prerequisites

- Basic knowledge of Laravel.
- API test tools installed, such as Postman

### Objectives

By the end of this tutorial, you should be able to authenticate your user's APIs and Single Page Applications (SPA) using Laravel sanctum.

### Project setup

Let's set up a Laravel project and install the Sanctum package.  

```bash
laravel new sanctumApp
```

This command generates your Laravel project skeleton, this may take a while depending on your internet connection.
Next, `cd` into your project root and run the following command:

```bash
cd sanctumApp
composer require laravel/sanctum
```

Output:

```bash
 - Installing laravel/sanctum (v2.11.2): Downloading (100%)         
.................
Discovered Package: fruitcake/laravel-cors
Discovered Package: laravel/sail
Discovered Package: laravel/sanctum
Discovered Package: laravel/tinker
....................

```

Now that we've `sanctum` installed, next, we configure and migrate its files by running the following command to publish them.

```bash
php artisan vendor:publish --provider="Laravel\Sanctum\SanctumServiceProvider"
```

Output:

```bash
Copied Directory [/vendor/laravel/sanctum/database/migrations] To [/database/migrations]
Copied File [/vendor/laravel/sanctum/config/sanctum.php] To [/config/sanctum.php]
Publishing complete.

```

With sanctum files published, let's now set up our database by editing the `.env` file contents as follows:

```properties
.............................
DB_CONNECTION=mysql #edit this connection depending on your connection
DB_HOST=127.0.0.1 #edit this to meet your requirements
DB_PORT=3306
DB_DATABASE=sanctum #this is generated by default
DB_USERNAME=EnterYourDBUsername
DB_PASSWORD=EnterYourDBPassoword
..........................
```

Now let's proceed and create our database on `MySQL server` by running the following command in the command line.  

```bash
mysql -u root -p
```

Output:

```bash
.................
Enter password: 
.....................
mysql> 

```

In front of `mysql>`, run the folcommandSQL commmand to create a `sanctum` database:

```bash
mysql> CREATE DATABASE sanctum;

```

Output:

```bash
Query OK, 1 row affected (0.06 sec)
```

Let's now proceed and migrate our application as shown below:

```bash

```

Output:

```bash
Migration table created successfully.
.........................................
Migrating: 2019_12_14_000001_create_personal_access_tokens_table
Migrated:  2019_12_14_000001_create_personal_access_tokens_table (203.38ms)

```

You notice that the `personal_tokens` table is generated.
This is important to note because we'll need it later on in the article.

With our database setup, one last step we'll need is to tell our `User` model about this package. Let's see how this is done.

```php
<?php
..........................................
use Laravel\Sanctum\HasApiTokens;

class User extends Authenticatable
{
    ....................
    use HasApiTokens;
..............................
    protected $fillable = [
        'name',
        'email',
        'password',
    ];
.............................
}

```

In the above `User` model, we have imported the `HasApiTokens` trait from `Laravel\Sanctum\HasApiTokens`. This trait exposes the `create token()` method that we'll use to issue tokens.

### Route authentications

Routing is one of the core features of a Laravel application. In this part, we set up our `api` routes in the `routes/api.php` file as follows:  

```php
<?php
...............
//import controller
use App\Http\Controllers\AuthenticationController;
................
//register new user
Route::post('/create-account', [AuthenticationController::class, 'createAccount']);
//login user
Route::post('/signin', [AuthenticationController::class, 'signin']);
//using middleware
Route::group(['middleware' => ['auth:sanctum']], function () {
    Route::get('/profile', function(Request $request) {
        return auth()->user();
    });
    Route::post('/sign-out', [AuthenticationController::class, 'logout']);
});

```

In the above script, we define 4 routes. The first one is a POST request to register a new user using the `AuthenticationController.createAccount()` method. We have also defined other routes, to `log in`, view user `profile`, and `logout` the users.  

You may have noticed that we also used the `AuthenticationController` while it had not been created. Let's go ahead and create this controller by running the following command:

```bash
php artisan make:controller AuthenticationController
```

Now proceed and edit this controller as followed:

```php
<?php

..............................................

class AuthenticationController extends Controller
{
    //this method adds new users
    public function createAccount(Request $request)
    {
        $attr = $request->validate([
            'name' => 'required|string|max:255',
            'email' => 'required|string|email|unique:users,email',
            'password' => 'required|string|min:6|confirmed'
        ]);

        $user = User::create([
            'name' => $attr['name'],
            'password' => bcrypt($attr['password']),
            'email' => $attr['email']
        ]);

        return $this->success([
            'token' => $user->createToken('tokens')->plainTextToken
        ]);
    }
    //use this method to signin users
    public function signin(Request $request)
    {
        $attr = $request->validate([
            'email' => 'required|string|email|',
            'password' => 'required|string|min:6'
        ]);

        if (!Auth::attempt($attr)) {
            return $this->error('Credentials not match', 401);
        }

        return $this->success([
            'token' => auth()->user()->createToken('API Token')->plainTextToken
        ]);
    }

    // this method signs out users by removing tokens
    public function signout()
    {
        auth()->user()->tokens()->delete();

        return [
            'message' => 'Tokens Revoked'
        ];
    }
}

```

In the above controller, we have got a very simple logic. `createAccount()` creates new validated users. It then generates tokens if registered successfully. `sign in()` authenticates the users and generates `access tokens` on successful login while `signout()` removes user session.

Now test your application on Postman.
